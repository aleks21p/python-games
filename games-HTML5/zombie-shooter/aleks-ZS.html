<!DOCTYPE html>
<html>
<head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width,initial-scale=1">
        <title>Zombie Shooter â€” JavaSnake.com</title>
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='70' font-size='70' text-anchor='middle' x='50'>ðŸ§Ÿ</text></svg>">
    <meta name="theme-color" content="#1b1b1b">
    <!-- Use the same display fonts as the index for a fancy theme -->
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Exo+2:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        /* UK-themed background and comfy canvas centering similar to index */
        body {
            font-family: 'Exo 2', sans-serif;
            background: linear-gradient(135deg, #0b1636 0%, #071230 50%, #021024 100%);
            color: #fff;
            margin: 0;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        /* subtle class to nudge canvas container z-order */
        canvas { box-shadow: 0 20px 40px rgba(0,0,0,0.6); border-radius: 12px; }
    </style>
        <meta name="description" content="Zombie Shooter â€” top-down arcade HTML5 game. Fight waves of zombies, collect power-ups and upgrade your weapons.">
        <meta property="og:site_name" content="JavaSnake.com">
        <meta property="og:title" content="Zombie Shooter â€” JavaSnake.com">
        <meta property="og:description" content="Top-down zombie shooter with upgrades, pets and boss battles. Play in your browser.">
        <meta property="og:type" content="game">
        <meta property="og:urlV  " content="https://javasnake.com/zombie-shooter/aleks-ZS.html">
        <meta property="og:image" content="https://javasnake.com/games-HTML5/preview.png">
        <meta name="twitter:card" content="summary_large_image">
        <meta name="twitter:title" content="Zombie Shooter â€” JavaSnake.com">
        <meta name="twitter:description" content="Top-down zombie shooter with upgrades, pets and boss battles. Play in your browser.">
        <meta name="twitter:image" content="https://javasnake.com/games-HTML5/preview.png">
        <script type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@type": "Game",
            "name": "Zombie Shooter",
            "description": "Top-down zombie shooter with upgrades, pets and boss battles.",
            "url": "https://javasnake.com/zombie-shooter/aleks-ZS.html"
        }
        </script>
        <style>
        canvas {
            border: 1px solid #000;
            display: block;
            margin: 0 auto;
            background: #000;
            /* Make the canvas scale responsively while keeping its internal resolution */
            width: 100%;
            max-width: 100vw; /* never exceed viewport width */
            height: auto; /* maintain aspect ratio */
            max-height: 100vh; /* don't overflow vertically */
            box-sizing: border-box;
            touch-action: none; /* prevent browser touch gestures while interacting with game */
        }
        body {
            display: flex;
            justify-content: center; 
            align-items: center;
            height: 100vh;
            margin: 0;
            background: #222;
        }
    </style>
    <style>
        /* Mobile layout helper class - body.mobile-layout indicates a narrow/touch viewport */
        body.mobile-layout {
            --hud-scale: 1.15; /* hint for scripts / CSS to use */
        }
        @media (max-width: 720px) {
            /* triggers mobile-layout via script when viewport is narrow */
        }
    </style>
</head>
<body>
    <!-- fixed internal resolution matches game constants (800x600); CSS will scale it to fit the viewport -->
    <canvas id="gameCanvas" width="800" height="600" aria-label="Zombie Shooter game canvas"></canvas>
    <script>
        // Ensure crisp rendering on high-DPR devices (runs before game.js initializes)
        (function() {
            try {
                const canvas = document.getElementById('gameCanvas');
                if (!canvas) return;
                const dpr = Math.min(window.devicePixelRatio || 1, 3); // cap DPR to avoid huge buffers

                // Determine the CSS display size the canvas should have (fit viewport while preserving 4:3 aspect)
                const vw = Math.max(document.documentElement.clientWidth || 0, window.innerWidth || 0);
                const vh = Math.max(document.documentElement.clientHeight || 0, window.innerHeight || 0);
                // target aspect 4:3 (800x600)
                const targetAspect = 800/600;
                let cssWidth = vw;
                let cssHeight = Math.round(cssWidth / targetAspect);
                if (cssHeight > vh) {
                    cssHeight = vh;
                    cssWidth = Math.round(cssHeight * targetAspect);
                }

                // Apply CSS size
                canvas.style.width = cssWidth + 'px';
                canvas.style.height = cssHeight + 'px';

                // Set backing store size for crisp rendering (scaled by DPR)
                canvas.width = Math.round(800 * dpr);
                canvas.height = Math.round(600 * dpr);

                // Scale the drawing context so game code may continue using 800x600 logical coords
                const ctx = canvas.getContext('2d');
                if (ctx && dpr !== 1) {
                    ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
                }

                // Expose flag for game.js (in case it wants to skip resizing)
                window.__GAME_CANVAS_SCALED = true;
            } catch (e) {
                // ignore
            }
        })();
        // Toggle mobile-layout class for responsive adjustments (also accessible to game.js)
        (function() {
            function updateMobileClass() {
                try {
                    const isTouch = 'ontouchstart' in window || navigator.maxTouchPoints > 0;
                    const vw = Math.max(document.documentElement.clientWidth || 0, window.innerWidth || 0);
                    const isNarrow = vw <= 720;
                    if (isTouch || isNarrow) document.body.classList.add('mobile-layout');
                    else document.body.classList.remove('mobile-layout');
                } catch (e) {}
            }
            updateMobileClass();
            window.addEventListener('resize', updateMobileClass);
            window.addEventListener('orientationchange', updateMobileClass);
        })();
    </script>
    <!-- Load autogenerated build-info if present (generated by GitHub Actions) -->
    <script>
        (function(){
            try {
                var s = document.createElement('script');
                s.src = 'build-info.js';
                s.async = false; // ensure it runs before game.js
                s.onload = function() { /* ok */ };
                s.onerror = function() { /* ignore if not present */ };
                document.head.appendChild(s);
            } catch (e) {}
        })();
    </script>
    
    <!-- Global mute listener: react to site-wide mute changes -->
    <script>
        (function(){
            const bc = (typeof BroadcastChannel !== 'undefined') ? new BroadcastChannel('javasnake-global') : null;
            function applyMuteState(muted) {
                try {
                    // If the game exposes an audio manager, try to mute it
                    if (window.game && window.game.audio && typeof window.game.audio.setMasterMute === 'function') {
                        window.game.audio.setMasterMute(muted);
                    } else if (window.game && window.game.audio && window.game.audio.masterGain) {
                        // best-effort: reduce master gain
                        try { window.game.audio.masterGain.gain.value = muted ? 0 : (window.game.audio._previousMasterGain || 0.35); } catch(e){}
                    } else {
                        // fallback: mute any <audio> elements on the page
                        document.querySelectorAll('audio').forEach(a => { a.muted = !!muted; });
                    }
                } catch (e) { console.warn('applyMuteState error', e); }
            }

            if (bc) {
                bc.addEventListener('message', (ev) => {
                    if (ev.data && ev.data.type === 'MUTE_CHANGED') {
                        applyMuteState(!!ev.data.muted);
                    }
                });
            }

            window.addEventListener('storage', (e) => {
                if (e.key === 'site_mute') applyMuteState(e.newValue === '1');
            });

            // Initialize
            applyMuteState(localStorage.getItem('site_mute') === '1');
        })();
    </script>

    <!-- Auto-update functionality for zombie shooter -->
    <script>
        (function() {
            let refreshTimeout;
            
            // Check for version updates
            async function checkForUpdates() {
                try {
                    const response = await fetch('../version.json', {
                        cache: 'no-cache',
                        headers: {
                            'Cache-Control': 'no-cache',
                            'Pragma': 'no-cache'
                        }
                    });
                    
                    if (response.ok) {
                        const versionData = await response.json();
                        const serverVersion = versionData.games['zombie-shooter'] || versionData.version;
                        const currentVersion = localStorage.getItem('zombie-shooter-version') || '1.0.0';
                        
                        if (serverVersion !== currentVersion) {
                            console.log('Zombie Shooter version mismatch:', currentVersion, '->', serverVersion);
                            localStorage.setItem('zombie-shooter-version', serverVersion);
                            
                            showUpdateNotification('New game version available! Updating automatically...');
                            
                            // Auto-refresh after 3 seconds
                            refreshTimeout = setTimeout(() => {
                                window.location.reload(true);
                            }, 3000);
                        }
                    }
                } catch (error) {
                    console.error('Zombie Shooter version check failed:', error);
                }
            }
            
            // Show update notification
            function showUpdateNotification(message) {
                if (refreshTimeout) {
                    clearTimeout(refreshTimeout);
                }
                
                let notification = document.getElementById('zs-update-notification');
                if (!notification) {
                    notification = document.createElement('div');
                    notification.id = 'zs-update-notification';
                    notification.style.cssText = `
                        position: fixed;
                        top: 20px;
                        left: 50%;
                        transform: translateX(-50%);
                        background: linear-gradient(45deg, #e74c3c, #c0392b);
                        color: white;
                        padding: 15px 25px;
                        border-radius: 25px;
                        font-weight: bold;
                        font-size: 1rem;
                        box-shadow: 0 6px 20px rgba(231, 76, 60, 0.4);
                        z-index: 10000;
                        text-align: center;
                        max-width: 90vw;
                        animation: slideDown 0.5s ease-out;
                        font-family: 'Exo 2', sans-serif;
                    `;
                    
                    // Add animation if not already present
                    if (!document.querySelector('#zs-update-style')) {
                        const style = document.createElement('style');
                        style.id = 'zs-update-style';
                        style.textContent = `
                            @keyframes slideDown {
                                from { transform: translateX(-50%) translateY(-100%); opacity: 0; }
                                to { transform: translateX(-50%) translateY(0); opacity: 1; }
                            }
                        `;
                        document.head.appendChild(style);
                    }
                    
                    document.body.appendChild(notification);
                }
                
                notification.textContent = message;
                notification.style.display = 'block';
                
                // Click to refresh immediately
                notification.onclick = () => {
                    window.location.reload(true);
                };
                notification.style.cursor = 'pointer';
                notification.title = 'Click to refresh now';
            }
            
            // Start version checking
            function startVersionChecking() {
                // Check immediately after 5 seconds
                setTimeout(checkForUpdates, 5000);
                
                // Then check every 60 seconds
                setInterval(checkForUpdates, 60000);
            }
            
            // Initialize when page loads
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', startVersionChecking);
            } else {
                startVersionChecking();
            }
        })();
    </script>
    
    <script src="game.js"></script>
</body>
</html>
